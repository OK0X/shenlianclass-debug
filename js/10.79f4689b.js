(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[10],{"12f6":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-page",{staticClass:"mypage"},[s("div",{staticClass:"buywatch"},[s("img",{staticClass:"course-cover",attrs:{src:e.global.api.aliyunosshostpubread+"/"+e.course.converimg,onerror:"src = 'statics/default-conver.png'"}}),s("div",{staticClass:"course-summary"},[s("div",{staticStyle:{display:"flex"}},[s("span",{staticStyle:{"font-size":"24px",color:"#1f2328"}},[e._v(e._s(e.course.classname))]),s("img",{staticClass:"edit-icon",attrs:{src:"statics/edit.png"},on:{click:e.editCourseName}})]),s("div",{staticStyle:{display:"flex"}},[s("span",[e._v(e._s(e.course.classsummary))]),s("img",{staticClass:"edit-icon",attrs:{src:"statics/edit.png"},on:{click:e.editClasssummary}})]),s("div",{staticClass:"course-price"},[s("div",{staticStyle:{"align-self":"center","margin-left":"10px","font-size":"24px",color:"orange"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:""!==e.course.classprice,expression:"course.classprice!==''"}],staticStyle:{display:"flex"}},[s("span",[e._v(e._s(e.course.classprice)+"元")]),s("img",{staticClass:"edit-icon",attrs:{src:"statics/edit.png"},on:{click:e.editCoursePrice}})]),s("span",{directives:[{name:"show",rawName:"v-show",value:""!==e.course.classprice&&""!==e.course.coin,expression:"course.classprice!==''&&course.coin!==''"}]},[e._v("+")]),s("div",{directives:[{name:"show",rawName:"v-show",value:""!==e.course.coin,expression:"course.coin!==''"}],staticStyle:{display:"flex"}},[s("span",[e._v(e._s(e.course.coin)+"积分")]),s("img",{staticClass:"edit-icon",attrs:{src:"statics/edit.png"},on:{click:e.editCourseCoin}})])]),s("div",{staticClass:"course-share",on:{click:e.courseShare}},[s("img",{staticStyle:{width:"20px",height:"20px"},attrs:{src:"statics/share.png"}}),s("span",{staticStyle:{"margin-left":"5px"}},[e._v("分享")])])]),s("div",{staticStyle:{display:"flex","margin-top":"10px"}},[s("span",[e._v("学习人数："+e._s(e.course.studynum)+"人")]),s("img",{staticClass:"edit-icon",attrs:{src:"statics/edit.png"},on:{click:e.editStudynum}})]),s("q-btn",{staticClass:"study",attrs:{unelevated:"",label:e.util.getCourseStatus(e.course.status),color:-1===e.course.status?"negative":"primary"}}),s("input",{staticStyle:{"margin-top":"10px"},attrs:{type:"file",accept:"image/*"},on:{change:e.converFileChange}}),s("div",[s("button",{staticStyle:{width:"72px","margin-top":"10px"},attrs:{type:"button",disabled:e.converUploadDisable},on:{click:e.uploadConverImg}},[e._v("开始上传")]),s("span",{staticStyle:{"margin-left":"10px"}},[e._v("上传进度："+e._s(e.converUProgress))]),s("span",{directives:[{name:"show",rawName:"v-show",value:"100%"===e.converUProgress,expression:"converUProgress === '100%'"}],staticStyle:{color:"green"}},[e._v("(已保存上传记录,相同图片无需再次上传)")])]),s("div",{staticStyle:{display:"flex","margin-top":"10px"}},[s("span",[e._v("当前排序："+e._s(e.course.sort))]),s("img",{staticClass:"edit-icon",attrs:{src:"statics/edit.png"},on:{click:e.editIndexSort}})])],1)]),s("div",{staticClass:"detail"},[s("q-tabs",{staticClass:"text-grey",attrs:{dense:"","active-color":"primary","indicator-color":"primary",align:"left","narrow-indicator":""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[s("q-tab",{attrs:{name:"detail",label:"课程介绍"}}),s("q-tab",{attrs:{name:"chapters",label:"课程目录"}})],1),s("q-separator"),s("q-tab-panels",{attrs:{animated:""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[s("q-tab-panel",{attrs:{name:"detail"}},[s("div",{domProps:{innerHTML:e._s(e.course.classdetail)}}),s("img",{staticClass:"edit-icon",attrs:{src:"statics/edit.png"},on:{click:function(t){e.editDetailShow=!e.editDetailShow}}}),s("VueEditor",{directives:[{name:"show",rawName:"v-show",value:e.editDetailShow,expression:"editDetailShow"}],staticStyle:{height:"580px",width:"100%","margin-bottom":"50px"},attrs:{useCustomImageHandler:""},on:{"image-added":e.handleImageAdded},model:{value:e.classdetail,callback:function(t){e.classdetail=t},expression:"classdetail"}}),s("q-btn",{directives:[{name:"show",rawName:"v-show",value:e.editDetailShow,expression:"editDetailShow"}],staticStyle:{width:"100px",margin:"10px","align-self":"center"},attrs:{unelevated:"",color:"primary",label:"提交修改"},on:{click:e.editClassdetail}})],1),s("q-tab-panel",{attrs:{name:"chapters"}},[s("q-timeline",{attrs:{color:"secondary"}},e._l(e.videos,(function(t,a){return s("q-timeline-entry",{key:a,attrs:{title:t.title,subtitle:""}},[s("div",[e._v(e._s(t.summary))]),s("div",[e._v("\n              视频状态：\n              "),s("span",{staticStyle:{color:"rgb(255, 122, 0)"}},[e._v(e._s(e.getVideoStatus(t.status)))])]),s("q-btn",{directives:[{name:"show",rawName:"v-show",value:e.user.role>=1&&1===e.course.status&&0===t.status,expression:"user.role>=1&&course.status===1&&item.status===0"}],staticStyle:{width:"100px","margin-top":"10px"},attrs:{unelevated:"",color:"primary",label:"转码"},on:{click:function(s){return e.videoMgr(t)}}})],1)})),1)],1)],1)],1),s("div",{staticClass:"detail",staticStyle:{padding:"16px"}},[s("span",{staticStyle:{"font-weight":"bold"}},[e._v("首页Banner设置")]),s("q-separator",{staticStyle:{margin:"10px 0 10px 0"}}),s("span",[e._v("Banner展示时间(单位:天 ,取消填: 0)：")]),s("q-input",{staticStyle:{width:"300px"},attrs:{dense:""},model:{value:e.bannertime,callback:function(t){e.bannertime=t},expression:"bannertime"}}),s("span",{staticStyle:{"margin-top":"20px"}},[e._v("副标题：")]),s("q-input",{staticStyle:{width:"300px"},attrs:{dense:"",counter:"",maxlength:"25"},model:{value:e.subtitle,callback:function(t){e.subtitle=t},expression:"subtitle"}}),s("span",{staticStyle:{"margin-top":"10px"}},[e._v("课程封面：(请上传尺寸为1200×400像素的jpg图片)")]),s("input",{staticStyle:{"margin-top":"10px"},attrs:{type:"file",accept:"image/*"},on:{change:e.bannerFileChange}}),s("img",{directives:[{name:"show",rawName:"v-show",value:e.imgShow,expression:"imgShow"}],staticStyle:{"margin-top":"10px",width:"1168px",height:"400px"},attrs:{src:e.imgsrc}}),s("div",[s("button",{staticStyle:{width:"72px","margin-top":"10px"},attrs:{type:"button",disabled:e.bannerUploadDisable},on:{click:e.uploadBannerImg}},[e._v("开始上传")]),s("span",{staticStyle:{"margin-left":"10px"}},[e._v("上传进度："+e._s(e.bannerUProgress))]),s("span",{directives:[{name:"show",rawName:"v-show",value:"100%"===e.bannerUProgress,expression:"bannerUProgress === '100%'"}],staticStyle:{color:"green"}},[e._v("(已保存上传记录,相同图片无需再次上传)")])]),s("q-btn",{staticStyle:{width:"100px",margin:"10px","align-self":"center"},attrs:{unelevated:"",color:"primary",label:"提交修改"},on:{click:e.setBanner}})],1),s("q-btn",{directives:[{name:"show",rawName:"v-show",value:e.user.role>=2&&0===e.course.status,expression:"user.role>=2&&course.status===0"}],staticStyle:{width:"100px","margin-bottom":"30px"},attrs:{unelevated:"",color:"primary",label:"审核通过"},on:{click:function(t){return e.changeCourseStatus(1)}}}),s("q-btn",{directives:[{name:"show",rawName:"v-show",value:e.isCanPub(),expression:"isCanPub()"}],staticStyle:{width:"100px","margin-bottom":"30px"},attrs:{unelevated:"",color:"primary",label:"发布"},on:{click:function(t){return e.changeCourseStatus(2)}}}),s("MyFooter"),s("ShareDialog",{attrs:{props:e.shareDialog}})],1)},i=[],r=(s("7f7f"),s("a3d9")),n=s("6b6b"),o=s("5873"),c={components:{MyFooter:r["a"],ShareDialog:n["a"],VueEditor:o["a"]},computed:{user:{get:function(){return this.$store.state.user.user},set:function(e){this.$store.commit("user/updateUser",e)}}},data:function(){return{tab:"detail",course:{},videos:[],shareDialog:{show:!1},bannertime:"",subtitle:"",imgsrc:"",imgShow:!1,bannerUProgress:"0%",bannerUploadDisable:!0,bannerImgName:"",bannerImgFile:null,classdetail:"",editDetailShow:!1,converImgFile:null,converImgName:"",converUploadDisable:!1,converUProgress:"0%"}},mounted:function(){"[object Object]"===this.$route.query.arg?this.course=this.global.routeCache.courseCheckDetail:(this.course=this.$route.query.arg,this.global.routeCache.courseCheckDetail=this.course),this.bannertime=0===this.course.carousel?"0":parseInt((this.course.carousel-(new Date).getTime())/1e3/60/60/24),this.subtitle=this.course.subtitle,this.imgShow=""!==this.course.carouselimg,this.imgsrc=this.global.api.aliyunosshostpubread+"/"+this.course.carouselimg,this.getVideos()},methods:{editClassdetail:function(){if(""!==this.classdetail)if(this.classdetail.length>2e3)toast("内容不能超过2000个字符");else{var e={classdetail:this.classdetail};this.modifyCourse(e)}else toast("请输入内容")},handleImageAdded:function(e,t,s,a){var i=this,r=(new Date).getTime()+e.name.substring(e.name.length-4);this.util.uploadFile2OSS(this,r,e,!0,null,(function(){t.insertEmbed(s,"image",i.global.api.aliyunosshostpubread+"/"+r),a()}))},editIndexSort:function(){this.modifySimpleTx("修改排序","sort")},editStudynum:function(){this.modifySimpleTx("修改人数","studynum")},editCourseCoin:function(){this.modifySimpleTx("修改课程积分","courseCoin")},editCoursePrice:function(){this.modifySimpleTx("修改课程售价","coursePrice")},editClasssummary:function(){this.modifySimpleTx("修改课程摘要","courseSummary")},editCourseName:function(){this.modifySimpleTx("修改课程名称","courseName")},modifySimpleTx:function(e,t){var s=this;this.$q.dialog({title:e,message:"",prompt:{model:"",type:"text"},ok:"确定",cancel:"取消",persistent:!1}).onOk((function(e){if(""!==e){var a=null;switch(t){case"courseName":if(e.length>25)return void toast("输入长度不能超过25个字符");a={classname:e};break;case"courseSummary":if(e.length>150)return void toast("输入长度不能超过150个字符");a={classsummary:e};break;case"coursePrice":if(e.length>10)return void toast("输入长度不能超过10个字符");a={classprice:e};break;case"courseCoin":if(e.length>10)return void toast("输入长度不能超过10个字符");a={coin:e};break;case"sort":if(e.length>4)return void toast("输入长度不能超过4个字符");a={sort:e};break;case"studynum":if(e.length>4)return void toast("输入长度不能超过4个字符");a={studynum:e};break;default:break}s.modifyCourse(a)}else toast("输入不能为空")})).onCancel((function(){})).onDismiss((function(){}))},converFileChange:function(e){var t=e.target.files||e.dataTransfer.files;t.length&&(this.converImgFile=t[0],this.converImgName=(new Date).getTime()+this.converImgFile.name.substring(this.converImgFile.name.length-4),this.converUploadDisable=!1,this.converUProgress="0%")},uploadConverImg:function(){var e=this;this.converUploadDisable=!0;var t=function(t){t.lengthComputable&&(e.converUProgress=Math.round(t.loaded/t.total*100)+"%")},s=function(){var t={converimg:e.converImgName};e.modifyCourse(t)};this.util.uploadFile2OSS(this,this.converImgName,this.converImgFile,!0,t,s)},bannerFileChange:function(e){var t=this,s=e.target.files||e.dataTransfer.files;if(s.length){this.bannerImgFile=s[0],this.bannerImgName=(new Date).getTime()+this.bannerImgFile.name.substring(this.bannerImgFile.name.length-4),this.bannerUploadDisable=!1,this.bannerUProgress="0%";var a=new FileReader;a.readAsDataURL(this.bannerImgFile),a.onload=function(e){t.imgsrc=e.target.result,t.imgShow=!0}}},uploadBannerImg:function(){var e=this;this.bannerUploadDisable=!0;var t=function(t){t.lengthComputable&&(e.bannerUProgress=Math.round(t.loaded/t.total*100)+"%")};this.util.uploadFile2OSS(this,this.bannerImgName,this.bannerImgFile,!0,t,null)},setBanner:function(){var e=null;e="0"===this.bannertime||""===this.bannertime?{carousel:0,subtitle:"",carouselimg:""}:{carousel:24*parseInt(this.bannertime)*60*60*1e3+(new Date).getTime(),subtitle:this.subtitle,carouselimg:this.bannerImgName},this.modifyCourse(e)},modifyCourse:function(e){var t=(new Date).getTime()+this.global.requestExpireT;this.$axios.put(this.global.api.backurl+"course/modifyCourse?course_id="+this.course.uuid,e,{headers:{"access-token":this.util.generateToken(JSON.stringify(e),t),timestamp2:t}}).then((function(e){200===e.status&&0===e.data.code&&toast("修改成功")})).catch((function(e){console.log(e)}))},courseShare:function(){this.shareDialog.tx="https://www.shenlianclass.com/#/CourseDetail?courseid="+this.course.uuid,this.shareDialog.show=!0},changeCourseStatus:function(e){var t=this,s={status:e+"",author:this.course.author},a=(new Date).getTime()+this.global.requestExpireT;this.$axios.put(this.global.api.backurl+"course/updateStatus?uuid="+this.course.uuid,s,{headers:{"access-token":this.util.generateToken(JSON.stringify(s),a),timestamp2:a}}).then((function(s){200===s.status&&0===s.data.code&&(t.course.status=e,toast("操作成功"+(2===e?",预计5分钟内生效":"")))}))},isCanPub:function(){if(this.user.uuid!==this.course.author||1!==this.course.status)return!1;for(var e=0;e<this.videos.length;e++)if(this.videos[e].status<=1)return!1;return!0},getTranscodeTask:function(e){var t=this,s=(new Date).getTime()+this.global.requestExpireT,a={TranscodeTaskId:this.videos[e].transcode_task_id};this.$axios.get(this.global.api.backurl+"vod/getTranscodeTask",{params:a,headers:{"access-token":this.util.generateToken(JSON.stringify(a),s),timestamp2:s}}).then((function(s){200===s.status&&0===s.data.code&&"CompleteAllSucc"===s.data.data.TranscodeTask.TaskStatus&&(t.videos[e].status=2)}))},videoMgr:function(e){var t=(new Date).getTime()+this.global.requestExpireT,s={videoid:e.video_id,course_id:this.course.uuid};this.$axios.get(this.global.api.backurl+"vod/submitTranscodeJob",{params:s,headers:{"access-token":this.util.generateToken(JSON.stringify(s),t),timestamp2:t}}).then((function(t){200===t.status&&0===t.data.code&&(toast("提交转码成功,10分钟后可查看转码结果"),e.status=1)}))},getVideoStatus:function(e){switch(e){case 0:return"待转码";case 1:return"转码中";case 2:return"转码成功";default:break}},getVideos:function(){var e=this,t=(new Date).getTime()+this.global.requestExpireT,s={course_id:this.course.uuid+""};this.$axios.get(this.global.api.backurl+"video/getVideos",{params:s,headers:{"access-token":this.util.generateToken(JSON.stringify(s),t),timestamp2:t}}).then((function(t){if(200===t.status&&0===t.data.code){e.videos=t.data.data;for(var s=0;s<e.videos.length;s++)1===e.videos[s].status?e.getTranscodeTask(s):e.videos[s].transresult=""}}))}}},l=c,u=(s("fd0a"),s("2877")),d=s("eebe"),m=s.n(d),h=s("9989"),g=s("9c40"),p=s("429b"),v=s("7460"),b=s("eb85"),f=s("adad"),y=s("823b"),w=s("05eb"),x=s("74af"),S=s("27f9"),C=Object(u["a"])(l,a,i,!1,null,"1e486ad6",null);t["default"]=C.exports;m()(C,"components",{QPage:h["a"],QBtn:g["a"],QTabs:p["a"],QTab:v["a"],QSeparator:b["a"],QTabPanels:f["a"],QTabPanel:y["a"],QTimeline:w["a"],QTimelineEntry:x["a"],QInput:S["a"]})},"65dc":function(e,t,s){},fd0a:function(e,t,s){"use strict";var a=s("65dc"),i=s.n(a);i.a}}]);