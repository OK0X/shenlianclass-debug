(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{"0baf":function(t,a,e){"use strict";var i=e("cdb0"),o=e.n(i);o.a},"49c6":function(t,a,e){},"6e93":function(t,a,e){"use strict";var i=e("bda1"),o=e.n(i);o.a},"7db1":function(t,a,e){"use strict";e.r(a);var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("q-page",{staticClass:"mypage"},[e("GoBack"),e("div",{staticClass:"white-block",staticStyle:{"margin-top":"5px"}},[e("div",{staticStyle:{display:"flex"}},[e("img",{staticStyle:{width:"80px",height:"80px","border-radius":"50%"},attrs:{src:t.user.avatar,onerror:"src = 'statics/default-avatar.gif'"}}),e("div",{staticClass:"flex-col",staticStyle:{"margin-left":"16px","justify-content":"space-around"}},[e("div",{staticStyle:{display:"flex"}},[e("span",[e("span",{staticClass:"tx-bold"},[t._v("昵称：")]),t._v("\n            "+t._s(t.user.nick)+"\n          ")]),e("img",{staticClass:"edit-icon",attrs:{src:"statics/edit.png"},on:{click:t.editNickName}})]),e("div",{staticStyle:{display:"flex"}},[e("span",[e("span",{staticClass:"tx-bold"},[t._v("电话：")]),t._v("\n            "+t._s(t.user.mobile)+"\n          ")]),e("img",{staticClass:"edit-icon",attrs:{src:"statics/edit.png"},on:{click:t.editMobile}})]),e("div",{staticStyle:{display:"flex"}},[e("img",{staticStyle:{width:"13px",height:"12px","align-self":"center"},attrs:{src:"statics/coin.png"}}),e("span",{staticStyle:{"margin-left":"10px"}},[t._v(t._s(t.user.coin)+" 积分")]),e("span",{staticStyle:{"margin-left":"10px",color:"#1976D2",cursor:"pointer"},on:{click:t.showCharge}},[t._v("充值")])])])]),e("input",{ref:"imgpicker",staticClass:"photo-pickup",attrs:{accept:"image/jpg, image/png",type:"file"},on:{change:function(a){return t.onFileChange(a)}}})]),e("div",{staticClass:"white-block",staticStyle:{"margin-bottom":"50px"}},[e("span",[t._v("积分明细")]),e("q-table",{staticStyle:{"margin-top":"10px"},attrs:{title:"",data:t.coinLogs,columns:t.columns,"row-key":"name",flat:"",bordered:""}})],1),e("MyFooter"),e("CropperDialog",{attrs:{data:t.cropperDialog},on:{uploadImgOK:t.uploadImgOK}}),e("LoginDialog",{attrs:{dialogData:t.loginDialog}}),e("PayWaitDialog",{attrs:{data:t.payWaitDialog},on:{finishedPay:t.finishedPay,paywithProblem:t.paywithProblem}}),e("FeedbackDialog",{attrs:{dialogData:t.feedbackDialog}}),e("CoinChargeDialog",{attrs:{dialogData:t.coinChargeDialog},on:{onCharge:t.onCharge}})],1)},o=[],s=e("a3d9"),n=e("198e"),r=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("q-dialog",{model:{value:t.data.show,callback:function(a){t.$set(t.data,"show",a)},expression:"data.show"}},[e("div",{staticClass:"cropper-dialog"},[e("h2",{staticStyle:{"margin-left":"10px"}},[t._v(t._s(t.data.title))]),e("div",{staticStyle:{width:"560px",height:"560px"}},[e("vueCropper",{ref:"cropper",attrs:{img:t.data.img,outputSize:t.option.size,autoCrop:!0,autoCropWidth:"150px",autoCropHeight:"150px",fixedBox:!0,centerBox:!0}})],1),e("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消"}}),e("q-btn",{attrs:{flat:"",label:"确定"},on:{click:t.onOk}})],1)],1)])},l=[],c=e("7e79"),u=(e("3452"),e("27ae"),{props:["data"],components:{VueCropper:c["VueCropper"]},data:function(){return{option:{size:1}}},computed:{user:{get:function(){return this.$store.state.user.user},set:function(t){this.$store.commit("user/updateUser",t)}}},methods:{onOk:function(){var t=this;this.$refs.cropper.getCropBlob((function(a){t.uploadImg(a)}))},uploadImg:function(t){var a=this;this.util.uploadFile2OSS(this,this.user.uuid+".jpg",t,!0,null,(function(){a.data.show=!1,a.$emit("uploadImgOK")}))}}}),g=u,p=(e("fe3a"),e("2877")),h=e("eebe"),d=e.n(h),f=e("24e8"),m=e("4b7e"),b=e("9c40"),y=e("7f67"),x=Object(p["a"])(g,r,l,!1,null,"434097b6",null),v=x.exports;d()(x,"components",{QDialog:f["a"],QCardActions:m["a"],QBtn:b["a"]}),d()(x,"directives",{ClosePopup:y["a"]});var C=e("51ff"),k=e("7137"),w=e("b06b"),D=e("a002"),_=e.n(D),S=e("f5ef"),q=e("0c1f"),$=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("q-dialog",{model:{value:t.dialogData.show,callback:function(a){t.$set(t.dialogData,"show",a)},expression:"dialogData.show"}},[e("div",{staticClass:"f-dialog"},[e("div",{staticClass:"text-h6",staticStyle:{margin:"10px 0 0 10px"}},[t._v("快捷充值：")]),e("div",{staticStyle:{display:"flex"}},[e("q-btn",{staticStyle:{width:"100px",margin:"10px 0 0 10px"},attrs:{outline:"",label:"2元",color:"orange"},on:{click:function(a){return t.coinCharge(2)}}}),e("q-btn",{staticStyle:{width:"100px",margin:"10px 0 0 10px"},attrs:{outline:"",label:"5元",color:"orange"},on:{click:function(a){return t.coinCharge(5)}}}),e("q-btn",{staticStyle:{width:"100px",margin:"10px 10px 0 10px"},attrs:{outline:"",label:"10元",color:"orange"},on:{click:function(a){return t.coinCharge(10)}}})],1),e("div",{staticStyle:{display:"flex"}},[e("q-btn",{staticStyle:{width:"100px",margin:"10px 0 0 10px"},attrs:{outline:"",label:"20元",color:"orange"},on:{click:function(a){return t.coinCharge(20)}}}),e("q-btn",{staticStyle:{width:"100px",margin:"10px 0 0 10px"},attrs:{outline:"",label:"50元",color:"orange"},on:{click:function(a){return t.coinCharge(50)}}}),e("q-btn",{staticStyle:{width:"100px",margin:"10px 10px 0 10px"},attrs:{outline:"",label:"100元",color:"orange"},on:{click:function(a){return t.coinCharge(100)}}})],1),e("div",{staticClass:"text-h6",staticStyle:{margin:"10px 0 0 10px"}},[t._v("自定义充值：")]),e("q-input",{staticStyle:{margin:"10px"},attrs:{dense:""},model:{value:t.chargeAmount,callback:function(a){t.chargeAmount=a},expression:"chargeAmount"}}),e("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消"}}),e("q-btn",{attrs:{flat:"",label:"确定"},on:{click:t.onOk}})],1)],1)])},O=[],P={props:["dialogData"],data:function(){return{chargeAmount:""}},computed:{user:{get:function(){return this.$store.state.user.user},set:function(t){this.$store.commit("user/updateUser",t)}}},methods:{coinCharge:function(t){this.$emit("onCharge",t),this.dialogData.show=!1},onOk:function(){""!==this.chargeAmount?parseInt(this.chargeAmount)<=1?toast("充值金额需大于1元"):parseInt(this.chargeAmount)>=5e3?toast("单次充值金额需小于5000元"):(this.$emit("onCharge",this.chargeAmount),this.dialogData.show=!1):toast("请输入充值金额")}}},T=P,I=(e("6e93"),e("27f9")),N=Object(p["a"])(T,$,O,!1,null,"475c1143",null),U=N.exports;d()(N,"components",{QDialog:f["a"],QBtn:b["a"],QInput:I["a"],QCardActions:m["a"]}),d()(N,"directives",{ClosePopup:y["a"]});var L={components:{MyFooter:s["a"],GoBack:n["a"],CropperDialog:v,LoginDialog:C["a"],PayWaitDialog:k["a"],FeedbackDialog:q["a"],CoinChargeDialog:U},data:function(){var t=this;return{coinChargeDialog:{show:!1},cropperDialog:{title:"剪裁头像",show:!1},loginDialog:{show:!1,title:"修改手机号",placeholder:"请输入新手机号"},payWaitDialog:{show:!1},out_trade_no:"",columns:[{name:"event",label:"消费类型",field:"event",align:"left"},{name:"change",label:"数量",field:"change",align:"center"},{name:"create_at",label:"时间",field:"create_at",format:function(a){return"".concat(t.util.timeUTC2Local(a))}}],coinLogs:[],feedbackDialog:{show:!1,title:"支付问题反馈",hint:"请描述您的问题"}}},computed:{user:{get:function(){return this.$store.state.user.user},set:function(t){this.$store.commit("user/updateUser",t)}}},mounted:function(){var t=this;"undefined"!==typeof this.$route.query.out_trade_no&&this.queryPayResult(this.$route.query.out_trade_no),S["a"].$on("loginok",(function(){t.getCoinLogs()})),this.getCoinLogs()},methods:{paywithProblem:function(){this.payWaitDialog.show=!1,this.feedbackDialog.event="支付问题-积分充值",this.feedbackDialog.extras={out_trade_no:this.out_trade_no},this.feedbackDialog.show=!0},getCoinLogs:function(){var t=this;if("undefined"!==typeof this.user.uuid){var a=(new Date).getTime()+this.global.requestExpireT,e={user_id:this.user.uuid};this.$axios.get(this.global.api.backurl+"user/getCoinChangeLog",{params:e,headers:{"access-token":this.util.generateToken(JSON.stringify(e),a),timestamp2:a}}).then((function(a){200===a.status&&0===a.data.code&&(t.coinLogs=a.data.data)}))}},showCharge:function(){this.coinChargeDialog.show=!0},onCharge:function(t){this.gotoPay(t)},finishedPay:function(){this.payWaitDialog.show=!1,this.queryPayResult(this.out_trade_no)},queryPayResult:function(t){var a=this;this.util.loadingShow(this);var e=(new Date).getTime()+this.global.requestExpireT,i={out_trade_no:t,subject_type:"2"};this.$axios.get(this.global.api.backurl+"alipay/getPayResult",{params:i,headers:{"access-token":this.util.generateToken(JSON.stringify(i),e),timestamp2:e}}).then((function(t){a.util.loadingHide(a),200===t.status&&0===t.data.code?toast("充值成功，积分已实时到账!"):6006===t.data.code&&toast("请完成支付后点击该操作"),a.getUserInfo(),a.getCoinLogs()})).catch((function(t){console.log(t)}))},gotoPay:function(t){var a=this;this.util.loadingShow(this);var e={user_id:this.user.uuid,subject_title:"积分充值",subject_id:this.util.randomUUID(),subject_type:"2",total_amount:t+"",return_url:"https://www.shenlianclass.com/#/MyInfo"},i=(new Date).getTime()+this.global.requestExpireT;this.$axios.post(this.global.api.backurl+"alipay/tradePagePay",e,{headers:{"access-token":this.util.generateToken(JSON.stringify(e),i),timestamp2:i}}).then((function(t){if(a.util.loadingHide(a),200===t.status&&0===t.data.code){a.payWaitDialog.show=!0;var e=t.data.data;a.out_trade_no=e.out_trade_no,Object(w["a"])(e.payurl)}}))},editMobile:function(){this.loginDialog.action="updateMobile",this.loginDialog.show=!0},editNickName:function(){var t=this;this.$q.dialog({title:"修改昵称",message:"",prompt:{model:"",type:"text"},ok:"确定",cancel:"取消",persistent:!0}).onOk((function(a){if(""!==a){var e={nick:a};t.updateUser(e)}else toast("请输入新的昵称")})).onCancel((function(){})).onDismiss((function(){}))},updateUser:function(t){var a=this,e=(new Date).getTime()+this.global.requestExpireT;this.$axios.put(this.global.api.backurl+"user/updateUser?uuid="+this.user.uuid,t,{headers:{"access-token":this.util.generateToken(JSON.stringify(t),e),timestamp2:e}}).then((function(t){200===t.status&&0===t.data.code&&(toast("设置成功"),a.getUserInfo())}))},getUserInfo:function(){var t=this,a=(new Date).getTime()+this.global.requestExpireT,e={uuid:this.user.uuid};this.$axios.get(this.global.api.backurl+"user/getinfo",{params:e,headers:{"access-token":this.util.generateToken(JSON.stringify(e),a),timestamp2:a}}).then((function(a){if(200===a.status&&0===a.data.code){var e=a.data.data;t.user=e,_.a.setItem("user",JSON.stringify(t.user))}})).catch((function(t){}))},uploadImgOK:function(){var t=JSON.parse(JSON.stringify(this.user));t.avatar=this.user.avatar+"?",Math.random(),this.user=t},onFileChange:function(t){var a=this,e=t.target.files||t.dataTransfer.files;if(e.length){var i=e[0],o=new FileReader;o.readAsDataURL(i),o.onload=function(t){a.cropperDialog.img=t.target.result,a.cropperDialog.show=!0,a.$refs.imgpicker.value=null}}}}},j=L,A=(e("0baf"),e("9989")),J=e("eb85"),Q=e("eaac"),E=Object(p["a"])(j,i,o,!1,null,"ad0378e0",null);a["default"]=E.exports;d()(E,"components",{QPage:A["a"],QSeparator:J["a"],QTable:Q["a"]})},bda1:function(t,a,e){},cdb0:function(t,a,e){},fe3a:function(t,a,e){"use strict";var i=e("49c6"),o=e.n(i);o.a}}]);