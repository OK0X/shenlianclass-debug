(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[19],{"4d9a":function(e,s,t){"use strict";t.r(s);var i=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("q-page",{staticClass:"mypage"},[t("GoBack"),t("div",{staticClass:"page-content",staticStyle:{"margin-top":"5px"}},[t("span",{staticStyle:{"margin-top":"20px"}},[e._v("资源类别：")]),t("div",{staticClass:"q-gutter-sm"},[t("q-radio",{attrs:{val:"course",label:"课程资源",disable:e.corResDisable},model:{value:e.resType,callback:function(s){e.resType=s},expression:"resType"}}),t("q-radio",{attrs:{val:"doc",label:"文档资源"},model:{value:e.resType,callback:function(s){e.resType=s},expression:"resType"}}),t("q-radio",{attrs:{val:"app",label:"应用资源"},model:{value:e.resType,callback:function(s){e.resType=s},expression:"resType"}}),t("q-radio",{attrs:{val:"other",label:"其它资源"},model:{value:e.resType,callback:function(s){e.resType=s},expression:"resType"}})],1),t("q-select",{directives:[{name:"show",rawName:"v-show",value:"course"===e.resType,expression:"resType==='course'"}],staticStyle:{width:"150px"},attrs:{options:e.courseOptions,label:"选择课程"},on:{input:e.courseSelected},model:{value:e.courseOptionsV,callback:function(s){e.courseOptionsV=s},expression:"courseOptionsV"}}),t("q-input",{directives:[{name:"show",rawName:"v-show",value:"course"===e.resType,expression:"resType==='course'"}],staticStyle:{width:"150px"},attrs:{placeholder:"资源大小"},model:{value:e.fileSize,callback:function(s){e.fileSize=s},expression:"fileSize"}}),t("q-input",{attrs:{placeholder:"资源名称",counter:"",maxlength:"50"},model:{value:e.resName,callback:function(s){e.resName=s},expression:"resName"}}),t("VueEditor",{staticStyle:{height:"300px",width:"100%",margin:"10px 0 50px 0"},attrs:{useCustomImageHandler:"",placeholder:"填写资源描述（可选）"},on:{"image-added":e.handleImageAdded},model:{value:e.resDescribe,callback:function(s){e.resDescribe=s},expression:"resDescribe"}}),t("span",{staticStyle:{"align-self":"flex-end",color:"rgba(0, 0, 0, 0.54)"}},[e._v(e._s(e.textLength(e.resDescribe))+" / 500")]),t("span",{directives:[{name:"show",rawName:"v-show",value:"course"!==e.resType,expression:"resType!=='course'"}],staticStyle:{color:"red","margin-top":"10px"}},[e._v("文件需小于50M")]),t("input",{directives:[{name:"show",rawName:"v-show",value:"course"!==e.resType,expression:"resType!=='course'"}],staticStyle:{"margin-top":"10px"},attrs:{type:"file",accept:"*/*"},on:{change:e.fileChanged}}),t("div",{directives:[{name:"show",rawName:"v-show",value:"course"!==e.resType,expression:"resType!=='course'"}]},[t("button",{staticStyle:{width:"72px","margin-top":"10px"},attrs:{type:"button",disabled:e.fileUploadDisable},on:{click:e.uploadFile}},[e._v("开始上传")]),t("span",{staticStyle:{"margin-left":"10px"}},[e._v("上传进度："+e._s(e.fileUProgress))]),t("span",{directives:[{name:"show",rawName:"v-show",value:"100%"===e.fileUProgress,expression:"fileUProgress === '100%'"}],staticStyle:{color:"green"}},[e._v("(已保存该节上传记录,相同资源无需再次上传)")])]),t("q-input",{staticStyle:{width:"150px"},attrs:{placeholder:"所需积分"},model:{value:e.needCoin,callback:function(s){e.needCoin=s},expression:"needCoin"}}),t("q-btn",{staticStyle:{width:"150px","margin-top":"20px"},attrs:{unelevated:"",color:"primary",label:"发布资源"},on:{click:e.submit}})],1),t("MyFooter")],1)},a=[],r=(t("a481"),t("7f7f"),t("c47a")),o=t.n(r),l=t("a3d9"),n=t("198e"),c=t("5873"),u={components:{MyFooter:l["a"],GoBack:n["a"],VueEditor:c["a"]},data:function(){return o()({resName:"",resDescribe:"",file:null,fileName:"",fileUploadDisable:!0,fileUProgress:"0%",fileSize:"",courseId:"",needCoin:"",resType:"course",courseRes:[],corResDisable:!1,courseOptions:[],courseOptionsV:null,courseName:""},"courseId","")},computed:{user:{get:function(){return this.$store.state.user.user},set:function(e){this.$store.commit("user/updateUser",e)}}},mounted:function(){this.getCourseHasRes()},methods:{courseSelected:function(e){this.resName=e.label,this.resDescribe=e.res_discribe,this.fileName=e.res_name,this.courseName=e.label,this.courseId=e.uuid},getCourseHasRes:function(){var e=this,s=(new Date).getTime()+this.global.requestExpireT,t={author:this.user.uuid};this.$axios.get(this.global.api.backurl+"course/getCourseHasRes",{params:t,headers:{"access-token":this.util.generateToken(JSON.stringify(t),s),timestamp2:s}}).then((function(s){if(200===s.status&&0===s.data.code)if(e.courseRes=s.data.data,0===e.courseRes.length)toast("当前没有可以发布的课程资源"),e.resType="doc",e.corResDisable=!0;else for(var t=0;t<e.courseRes.length;t++)e.courseOptions.push({label:e.courseRes[t].classname,value:e.courseRes[t].classname,res_discribe:e.courseRes[t].res_discribe,res_name:e.courseRes[t].res_name,uuid:e.courseRes[t].uuid})})).catch((function(e){console.log(e)}))},handleImageAdded:function(e,s,t,i){var a=this,r=(new Date).getTime()+e.name.substring(e.name.length-4);this.util.uploadFile2OSS(this,r,e,!0,null,(function(){s.insertEmbed(t,"image",a.global.api.aliyunosshostpubread+"/"+r),i()}))},textLength:function(e){e=e.replace(/<\/?[^>]+(>|$)/g,"");var s=e.length;return s},fileChanged:function(e){var s=e.target.files||e.dataTransfer.files;s.length&&(this.file=s[0],this.fileSize=(this.file.size/1024/1024).toFixed(2),this.fileName=(new Date).getTime()+this.file.name.substring(this.file.name.length-4),this.fileUploadDisable=!1,this.fileUProgress="0%")},uploadFile:function(){var e=this;this.fileUploadDisable=!0;var s=function(s){s.lengthComputable&&(e.fileUProgress=Math.round(s.loaded/s.total*100)+"%")};this.util.uploadFile2OSS(this,this.fileName,this.file,!1,s,null)},submit:function(){var e=this;if(""!==this.resName)if(""!==this.fileName)if(""!==this.fileSize)if(""!==this.needCoin){var s={user_id:this.user.uuid,type:this.resType,name:this.resName,filename:this.fileName,filesize:this.fileSize,coin:this.needCoin,discribe:this.resDescribe,course_name:this.courseName,course_id:this.courseId},t=(new Date).getTime()+this.global.requestExpireT;this.util.loadingShow(this),this.$axios.post(this.global.api.backurl+"resourcedown/creatRes",s,{headers:{"access-token":this.util.generateToken(JSON.stringify(s),t),timestamp2:t}}).then((function(s){e.util.loadingHide(e),200===s.status&&0===s.data.code&&(toast("发布成功，5分钟后生效"),e.$router.replace("/ResourceDown"))})).catch((function(s){e.util.loadingHide(e),console.log(s)}))}else toast("请填写下载所需积分数量");else toast("资源大小不能为空");else toast("文件名不存在");else toast("资源名称不能为空")}}},p=u,d=t("2877"),h=t("eebe"),m=t.n(h),f=t("9989"),g=t("3786"),b=t("ddd8"),v=t("27f9"),y=t("9c40"),x=Object(d["a"])(p,i,a,!1,null,"fc027008",null);s["default"]=x.exports;m()(x,"components",{QPage:f["a"],QRadio:g["a"],QSelect:b["a"],QInput:v["a"],QBtn:y["a"]})}}]);