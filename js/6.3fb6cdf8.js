(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{"4b89":function(e,s,t){"use strict";var a=t("fbc2"),i=t.n(a);i.a},bd8e:function(e,s,t){"use strict";t.r(s);var a=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("q-page",{staticClass:"mypage"},[t("GoBack",{directives:[{name:"show",rawName:"v-show",value:e.showBack,expression:"showBack"}]}),t("div",{staticClass:"summary-part",style:e.showBack?"margin-top:5px;":"margin-top:50px;"},[t("img",{staticClass:"course-cover",attrs:{src:e.global.api.aliyunosshostpubread+"/"+e.course.converimg,onerror:"src = 'statics/default-conver.png'"}}),t("div",{staticClass:"course-summary"},[t("span",{staticStyle:{"font-size":"24px",color:"#1f2328"}},[e._v(e._s(e.course.classname))]),t("span",[e._v(e._s(e.course.classsummary))]),t("div",{staticClass:"course-price"},[t("div",{staticStyle:{"align-self":"center","margin-left":"10px","font-size":"24px",color:"orange"}},[t("span",{directives:[{name:"show",rawName:"v-show",value:""!==e.course.classprice,expression:"course.classprice!==''"}]},[e._v(e._s(e.course.classprice)+"元")]),t("span",{directives:[{name:"show",rawName:"v-show",value:""!==e.course.classprice&&""!==e.course.coin,expression:"course.classprice!==''&&course.coin!==''"}]},[e._v("+")]),t("span",{directives:[{name:"show",rawName:"v-show",value:""!==e.course.coin,expression:"course.coin!==''"}]},[e._v(e._s(e.course.coin)+"积分")])]),t("div",{staticClass:"course-share",on:{click:e.courseShare}},[t("img",{staticStyle:{width:"20px",height:"20px"},attrs:{src:"statics/share.png"}}),t("span",{staticStyle:{"margin-left":"5px"}},[e._v("分享")])])]),t("span",{staticStyle:{"margin-top":"20px"}},[e._v("学习人数："+e._s(e.course.studynum)+"人")]),t("q-btn",{directives:[{name:"show",rawName:"v-show",value:!e.isPayed,expression:"!isPayed"}],staticClass:"orenge-btn",attrs:{unelevated:"",label:"立即学习"},on:{click:e.buyCourse}})],1)]),t("div",{staticClass:"detail-part"},[t("q-tabs",{staticStyle:{"background-color":"#ebecec",color:"black"},attrs:{dense:"","active-color":"primary","indicator-color":"white","active-bg-color":"white",align:"left"},model:{value:e.tab,callback:function(s){e.tab=s},expression:"tab"}},[t("q-tab",{attrs:{name:"detail",label:"课程介绍"}}),t("q-tab",{attrs:{name:"chapters",label:"课程目录"}}),t("q-tab",{attrs:{name:"resources",label:"课程资源"}}),t("q-tab",{attrs:{name:"homework",label:"课后作业"}}),t("q-tab",{attrs:{name:"appraise",label:"课程评价"}})],1),t("q-tab-panels",{attrs:{animated:""},model:{value:e.tab,callback:function(s){e.tab=s},expression:"tab"}},[t("q-tab-panel",{attrs:{name:"detail"}},[t("div",{domProps:{innerHTML:e._s(e.course.classdetail)}})]),t("q-tab-panel",{attrs:{name:"chapters"}},e._l(e.videos,(function(s,a){return t("div",{key:a,staticClass:"chapter-info",attrs:{subtitle:""},on:{click:function(t){return e.chapterPlay(a,s)}}},[t("div",{staticClass:"chapter-progress"},[t("img",{staticStyle:{width:"25px",height:"25px","margin-top":"4px"},attrs:{src:s.finished?"statics/finished.png":"statics/ing.png"}}),a!==e.videos.length-1?t("div",{staticClass:"chapter-progress-line",style:s.finished?"background:#ff9800":"background:#26A69A"}):e._e()]),t("div",{staticClass:"chapter-summary"},[t("h1",{staticStyle:{margin:"0 0 10px 0"}},[e._v(e._s("第"+(a+1)+"节："+s.title))]),t("div",[e._v(e._s(s.summary))]),s.freesee?t("q-btn",{staticClass:"orenge-btn",staticStyle:{width:"100px",height:"36px","font-size":"14px","margin-top":"10px"},attrs:{unelevated:"",label:"试看"}}):e._e(),s.freesee?e._e():t("q-btn",{staticStyle:{width:"100px","margin-top":"10px"},attrs:{unelevated:"",color:"primary",label:"观看"}})],1)])})),0),t("q-tab-panel",{attrs:{name:"resources"}},[t("div",{domProps:{innerHTML:e._s(""===e.course.res_discribe?"该课程无额外资源":e.course.res_discribe)}}),t("div",{directives:[{name:"show",rawName:"v-show",value:""!==e.course.res_discribe,expression:"course.res_discribe!==''"}],staticStyle:{display:"flex",cursor:"pointer"},on:{click:e.downloadRes}},[t("img",{staticStyle:{width:"32px",height:"32px"},attrs:{src:e.setFileIcon()}}),t("span",{staticClass:"tx-cour-res"},[e._v(e._s(e.course.res_name))])])]),t("q-tab-panel",{staticClass:"flex-col",attrs:{name:"homework"}},[t("div",{domProps:{innerHTML:e._s(""===e.course.homework?"该课程无作业":e.course.homework)}}),t("q-separator",{directives:[{name:"show",rawName:"v-show",value:e.isWorkFinished,expression:"isWorkFinished"}]}),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isWorkFinished&&""!==e.course.homework,expression:"!isWorkFinished&&course.homework!==''"}],staticClass:"flex-col"},[t("VueEditor",{staticStyle:{height:"300px",width:"100%","margin-bottom":"50px","margin-top":"20px"},attrs:{useCustomImageHandler:""},on:{"image-added":e.handleImageAdded},model:{value:e.homework,callback:function(s){e.homework=s},expression:"homework"}}),t("span",{staticStyle:{"align-self":"flex-end",color:"rgba(0, 0, 0, 0.54)"}},[e._v(e._s(e.textLength(e.homework))+" / 1000")]),t("q-btn",{staticStyle:{width:"150px","margin-top":"10px"},attrs:{unelevated:"",color:"primary",label:"提交作业"},on:{click:e.submitHomeWork}},[t("q-tooltip",{attrs:{"content-class":"bg-amber text-black shadow-4",offset:[10,10]}},[e._v("提交作业后可阅览他人作业")])],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.isWorkFinished,expression:"isWorkFinished"}],staticClass:"flex-col",staticStyle:{margin:"30px"}},[t("CommentReply",{directives:[{name:"show",rawName:"v-show",value:""!==e.myanswer,expression:"myanswer!==''"}],attrs:{answerType:"myanswer",answer:e.myanswer,ask:e.homeworkAsk,option:e.CROption},on:{needLogin:e.needLogin}}),t("q-separator",{directives:[{name:"show",rawName:"v-show",value:""!==e.myanswer,expression:"myanswer!==''"}],staticStyle:{margin:"20px 0 20px 0",background:"rgba(0, 0, 0, 0.06)"}}),e._l(e.answers,(function(s,a){return t("div",{key:a,staticClass:"flex-col"},[t("CommentReply",{attrs:{answerType:"other",answer:s,ask:e.homeworkAsk,option:e.CROption},on:{needLogin:e.needLogin}}),a!==e.answers.length-1?t("q-separator",{staticStyle:{margin:"20px 0 20px 0",background:"rgba(0, 0, 0, 0.06)"}}):e._e()],1)})),e.pageMax>1?t("q-pagination",{staticStyle:{"margin-top":"30px","align-self":"center"},attrs:{max:e.pageMax,"direction-links":!0},on:{input:e.paginationClick},model:{value:e.currentPage,callback:function(s){e.currentPage=s},expression:"currentPage"}}):e._e()],2)],1),t("q-tab-panel",{staticClass:"flex-col",attrs:{name:"appraise"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.showAppraise,expression:"showAppraise"}],staticClass:"flex-col"},[t("q-input",{attrs:{filled:"",type:"textarea",counter:"",maxlength:"200"},model:{value:e.appraiseText,callback:function(s){e.appraiseText=s},expression:"appraiseText"}}),t("q-rating",{attrs:{max:"5",size:"2em",color:"orange",icon:"star_border","icon-selected":"star","icon-half":"star_half","no-dimming":""},model:{value:e.appraiseStar,callback:function(s){e.appraiseStar=s},expression:"appraiseStar"}}),t("q-btn",{staticStyle:{width:"150px","margin-top":"20px"},attrs:{unelevated:"",color:"primary",label:"提交评价"},on:{click:e.submitAppraise}}),t("q-separator",{directives:[{name:"show",rawName:"v-show",value:0!==e.allAppraises.length,expression:"allAppraises.length!==0"}],staticStyle:{"margin-top":"20px"}})],1),e._l(e.allAppraises,(function(s,a){return t("div",{key:a,staticClass:"flex-col"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.user.uuid===s.user_id,expression:"user.uuid===appraises.user_id"}],staticStyle:{display:"flex","margin-top":"10px"}},[t("img",{staticStyle:{width:"16px",height:"16px","align-self":"center"},attrs:{src:"statics/mark.png"}}),t("span",{staticClass:"mytx-primary"},[e._v("我的评价")])]),t("div",{staticStyle:{display:"flex","margin-top":"10px"}},[t("img",{staticStyle:{width:"40px",height:"40px","border-radius":"50%","margin-right":"10px"},attrs:{src:e.getAvatar(s.user_id),onerror:"src = 'statics/default-avatar.gif'"}}),t("div",{staticClass:"flex-col"},[t("span",{staticStyle:{"font-size":"14px",color:"#333"}},[e._v(e._s(s.nick))]),t("span",{staticStyle:{"font-size":"12px",color:"#9eacb6"}},[e._v(e._s(e.util.getShortTime(s.create_at)))])])]),t("q-rating",{staticStyle:{"margin-top":"10px"},attrs:{max:"5",size:"2em",color:"orange",icon:"star_border","icon-selected":"star","icon-half":"star_half","no-dimming":"",readonly:""},model:{value:s.star,callback:function(t){e.$set(s,"star",t)},expression:"appraises.star"}}),t("span",{staticStyle:{margin:"10px 0 10px 0"}},[e._v(e._s(s.content))]),t("q-separator",{directives:[{name:"show",rawName:"v-show",value:a!==e.allAppraises.length-1,expression:"index!==allAppraises.length-1"}]})],1)}))],2)],1)],1),t("MyFooter"),t("VideoDialog",{attrs:{videoDialog:e.videoDialog}}),t("LoginDialog",{attrs:{dialogData:e.loginDialog}}),t("PayWaitDialog",{attrs:{data:e.payWaitDialog},on:{finishedPay:e.finishedPay,paywithProblem:e.paywithProblem}}),t("FeedbackDialog",{attrs:{dialogData:e.feedbackDialog}}),t("ShareDialog",{attrs:{props:e.shareDialog}})],1)},i=[],r=(t("a481"),t("7f7f"),t("a3d9")),o=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("q-dialog",{attrs:{persistent:"",maximized:e.maximizedToggle,"transition-show":"slide-up","transition-hide":"slide-down"},on:{show:e.onShow},model:{value:e.videoDialog.show,callback:function(s){e.$set(e.videoDialog,"show",s)},expression:"videoDialog.show"}},[t("q-card",{staticClass:"bg-black text-white"},[t("q-card-section",{staticStyle:{display:"flex","justify-content":"space-between"}},[t("div",{staticStyle:{display:"flex"}},[t("div",{on:{click:e.close}},[t("img",{staticStyle:{width:"35px",height:"35px",cursor:"pointer"},attrs:{src:"statics/back-white.png"}}),t("q-tooltip",{attrs:{"content-class":"bg-white text-primary"}},[e._v("返回")])],1),t("div",{staticClass:"text-h6",staticStyle:{"margin-left":"15px"}},[e._v(e._s("第"+(e.playIndex+1)+"节："+e.currentVideo.title))])]),t("div",{on:{click:e.close}},[t("img",{staticStyle:{width:"35px",height:"35px",cursor:"pointer"},attrs:{src:"statics/close.png"}}),t("q-tooltip",{attrs:{"content-class":"bg-white text-primary"}},[e._v("关闭")])],1)]),t("q-card-section",{staticStyle:{display:"flex"}},[t("div",{staticStyle:{"flex-shrink":"0"},attrs:{id:"ali-h5-player"}}),t("div",{staticStyle:{margin:"10px"}},e._l(e.videos,(function(s,a){return t("div",{key:a},[t("q-expansion-item",{style:a===e.playIndex?"color:#ff9800":"color:white",attrs:{"switch-toggle-side":"","expand-separator":"",label:"第"+(a+1)+"节："+s.title}},[t("q-card",[t("q-card-section",{staticStyle:{background:"black"}},[e._v(e._s(s.summary))])],1),t("q-btn",{directives:[{name:"show",rawName:"v-show",value:a!==e.playIndex,expression:"index!==playIndex"}],staticStyle:{"margin-left":"15px"},attrs:{outline:"",color:"primary",label:"播放"},on:{click:function(s){return e.switchVideo(a)}}})],1)],1)})),0)])],1)],1)},n=[],c=t("a002"),l=t.n(c),u={props:["videoDialog"],data:function(){return{player:null,maximizedToggle:!0,PlayAuth:"",MtsHlsUriToken:"",videos:[],playIndex:0,currentVideo:"",width:"1536px",height:"864px",cover:"https://shenlianclasspubread.oss-cn-shanghai.aliyuncs.com/play-cover.jpg",playVID:""}},computed:{user:{get:function(){return this.$store.state.user.user},set:function(e){this.$store.commit("user/updateUser",e)}}},methods:{onShow:function(){this.videos=this.videoDialog.videos,this.playIndex=this.videoDialog.currentPlay,this.currentVideo=this.videos[this.playIndex],this.playVID=this.currentVideo.video_id,this.player=new Aliplayer({id:"ali-h5-player",source:"//player.alicdn.com/video/editor.mp4",width:this.width,height:this.height,cover:this.cover,autoplay:!1,preload:!1,isLive:!1},(function(e){})),this.getPlayAuth()},getPlayAuth:function(){var e=this,s=(new Date).getTime()+this.global.requestExpireT,t={VideoId:this.playVID};this.$axios.get(this.global.api.backurl+"vod/getVideoPlayAuth",{params:t,headers:{"access-token":this.util.generateToken(JSON.stringify(t),s),timestamp2:s}}).then((function(s){200===s.status&&0===s.data.code&&(e.PlayAuth=s.data.data.PlayAuth,e.getPlayToken())}))},getPlayToken:function(){var e=this,s=(new Date).getTime()+this.global.requestExpireT,t={videoid:this.playVID};this.$axios.get(this.global.api.backurl+"vod/generateToken",{params:t,headers:{"access-token":this.util.generateToken(JSON.stringify(t),s),timestamp2:s}}).then((function(s){200===s.status&&0===s.data.code&&(e.MtsHlsUriToken=s.data.data,e.player.dispose(),document.getElementById("ali-h5-player").innerHTML="",e.player=new Aliplayer({id:"ali-h5-player",vid:e.playVID,playauth:e.PlayAuth,qualitySort:"asc",format:"m3u8",mediaType:"video",width:e.width,height:e.height,cover:e.cover,autoplay:!0,preload:!0,isLive:!1,rePlay:!1,useH5Prism:!0,vodRetry:0,playConfig:{MtsHlsUriToken:e.MtsHlsUriToken}},(function(s){s.on("ended",(function(){if(e.updateProgress(),e.playIndex++,e.playIndex<e.videos.length){if(!e.videoDialog.course_payed)return toast("请购买后观看"),void(e.videoDialog.show=!1);e.currentVideo=e.videos[e.playIndex],e.playVID=e.currentVideo.video_id,e.getPlayAuth()}})),s.fullscreenService.requestFullScreen(),l.a.getItem(e.playVID).then((function(t){var a=0;if(null!==t)a=t;else if("undefined"!==typeof e.videoDialog.studyProgress){var i=e.videoDialog.studyProgress[e.playVID];"undefined"!==typeof i&&(a=i)}a=parseInt(a)-5,s.seek(a>0?a:0)}))})))}))},switchVideo:function(e){if(this.playIndex!==e){if(this.updateProgress(),!this.videoDialog.course_payed)return toast("请购买后观看"),void(this.videoDialog.show=!1);this.playIndex=e,this.currentVideo=this.videos[this.playIndex],this.playVID=this.currentVideo.video_id,this.getPlayAuth()}},close:function(){this.videoDialog.show=!1,this.updateProgress(),l.a.setItem(this.playVID,this.player.getCurrentTime()),this.player.dispose()},updateProgress:function(){var e={user_id:this.user.uuid,course_id:this.videoDialog.course_id,video_id:this.playVID,progress:parseInt(this.player.getCurrentTime())+"",total:parseInt(this.player.getDuration())+""},s=(new Date).getTime()+this.global.requestExpireT;this.$axios.put(this.global.api.backurl+"studyProgress/updateProgress",e,{headers:{"access-token":this.util.generateToken(JSON.stringify(e),s),timestamp2:s}}).then((function(e){200===e.status&&e.data.code}))}}},d=u,h=(t("ccb3"),t("2877")),p=t("eebe"),m=t.n(p),g=t("24e8"),y=t("f09f"),f=t("a370"),w=t("05c0"),v=t("3b73"),b=t("9c40"),k=Object(h["a"])(d,o,n,!1,null,"83d066b0",null),x=k.exports;m()(k,"components",{QDialog:g["a"],QCard:y["a"],QCardSection:f["a"],QTooltip:w["a"],QExpansionItem:v["a"],QBtn:b["a"]});var _=t("b06b"),P=t("51ff"),D=t("198e"),S=t("f5ef"),T=t("7137"),q=t("5873"),A=t("373b"),C=t("0c1f"),I=t("6b6b"),N={components:{MyFooter:r["a"],VideoDialog:x,LoginDialog:P["a"],GoBack:D["a"],PayWaitDialog:T["a"],VueEditor:q["a"],CommentReply:A["a"],FeedbackDialog:C["a"],ShareDialog:I["a"]},data:function(){return{showBack:!0,showAppraise:!0,allAppraises:[],appraiseText:"",appraiseStar:3,CROption:{showCai:!1},tab:"detail",course:{},videos:[],videoDialog:{show:!1},loginDialog:{show:!1,title:"快捷登陆"},isPayed:!1,out_trade_no:"",payurl:"",studyProgress:{},payWaitDialog:{show:!1},homework:"",homeworkAsk:"",isWorkFinished:!1,myanswer:"",feedbackDialog:{show:!1,title:"支付问题反馈",hint:"请描述您的问题"},shareDialog:{show:!1},answers:[],zcClickNum:{},currentPage:1,lastPage:1,offset:0,limit:20,pageMax:1}},computed:{user:{get:function(){return this.$store.state.user.user},set:function(e){this.$store.commit("user/updateUser",e)}}},mounted:function(){var e=this;"undefined"!==typeof this.$route.query.out_trade_no?this.queryPayResult(this.$route.query.out_trade_no):"undefined"!==typeof this.$route.query.courseid?(this.showBack=!1,this.getCourseById(this.$route.query.courseid)):("[object Object]"===this.$route.query.arg?this.course=this.global.routeCache.courseDetail:(this.course=this.$route.query.arg,this.global.routeCache.courseDetail=this.course),this.homeworkAsk={hasaccept:1,reward:0,user_id:this.course.author,uuid:this.course.uuid},"myclass"===this.$route.query.from&&(this.isPayed=!0,this.tab="chapters"),this.getVideos(),this.getAppraise(),this.isMyWorkFinish(),this.checkisPayed()),S["a"].$on("loginok",(function(){e.checkisPayed(),e.isMyWorkFinish(),e.findMyAppraises(),e.getAnswer()})),S["a"].$on("logout",(function(){e.isWorkFinished=!1,e.showAppraise=!0,e.isPayed=!1,e.homework="",e.getAnswer()})),this.getAnswer()},methods:{paginationClick:function(e){this.lastPage!==e&&(this.offset+=this.limit*(e-this.lastPage),this.lastPage=e,this.getAnswer())},getAnswer:function(){var e=this;if("undefined"!==typeof this.user.uuid){var s=(new Date).getTime()+this.global.requestExpireT,t={ask_id:this.course.uuid,limit:this.limit+"",offset:this.offset+"",user_id:this.user.uuid};this.$axios.get(this.global.api.backurl+"ask/getAnswer",{params:t,headers:{"access-token":this.util.generateToken(JSON.stringify(t),s),timestamp2:s}}).then((function(s){if(200===s.status&&0===s.data.code){var t=s.data.data.total[0].total;e.pageMax=Math.ceil(t/e.limit);for(var a=s.data.data.answers,i=0;i<a.length;i++){a[i].comments_show=!1,a[i].comment_new="",a[i].nickname="",a[i].avatar="",a[i].zan=!1,a[i].cai=!1;for(var r=0;r<a[i].comments.length;r++)a[i].comments[r].comments_show=!1,a[i].comments[r].comment_new="",a[i].comments[r].nickname="",a[i].comments[r].avatar="",a[i].comments[r].zan=!1}e.answers=a,e.totalAnswerNum=t;var o=s.data.data.myanswer;if(""!==o){o.comments_show=!1,o.comment_new="",o.nickname=e.user.nick,o.avatar=e.user.avatar,o.zan=!1,o.cai=!1;for(var n=0;n<o.comments.length;n++)o.comments[n].comments_show=!1,o.comments[n].comment_new="",o.comments[n].nickname="",o.comments[n].avatar="",o.comments[n].zan=!1;e.myanswer=o}else e.myanswer="";e.getNicknames(),e.getZanCai()}})).catch((function(e){console.log(e)}))}},getZanCai:function(){for(var e=this,s=[],t=0;t<this.answers.length;t++){s.push(this.answers[t].uuid);for(var a=0;a<this.answers[t].comments.length;a++)s.push(this.answers[t].comments[a].uuid)}if(""!==this.myanswer){s.push(this.myanswer.uuid);for(var i=0;i<this.myanswer.comments.length;i++)s.push(this.myanswer.comments[i].uuid)}if(0!==s.length){var r=(new Date).getTime()+this.global.requestExpireT,o={user_id:this.user.uuid,ask_id:this.course.uuid,ans_com_id:encodeURIComponent(JSON.stringify(s))};this.$axios.get(this.global.api.backurl+"ask/getZanCai",{params:o,headers:{"access-token":this.util.generateToken(JSON.stringify(o),r),timestamp2:r}}).then((function(s){if(200===s.status&&0===s.data.code){for(var t=s.data.data,a={},i=0;i<t.length;i++)a[t[i].ans_com_id]={zan:t[i].zan,cai:t[i].cai};if(""!==e.myanswer){"undefined"!==typeof a[e.myanswer.uuid]?(e.myanswer.zan=a[e.myanswer.uuid].zan,e.myanswer.cai=a[e.myanswer.uuid].cai):(e.myanswer.zan=!1,e.myanswer.cai=!1);for(var r=0;r<e.myanswer.comments.length;r++)"undefined"!==typeof a[e.myanswer.comments[r].uuid]?e.myanswer.comments[r].zan=a[e.myanswer.comments[r].uuid].zan:e.myanswer.comments[r].zan=!1}for(var o=0;o<e.answers.length;o++){"undefined"!==typeof a[e.answers[o].uuid]?(e.answers[o].zan=a[e.answers[o].uuid].zan,e.answers[o].cai=a[e.answers[o].uuid].cai):(e.answers[o].zan=!1,e.answers[o].cai=!1);for(var n=0;n<e.answers[o].comments.length;n++)"undefined"!==typeof a[e.answers[o].comments[n].uuid]?e.answers[o].comments[n].zan=a[e.answers[o].comments[n].uuid].zan:e.answers[o].comments[n].zan=!1}}})).catch((function(e){console.log(e)}))}},getNicknames:function(){for(var e=this,s=(new Date).getTime()+this.global.requestExpireT,t=[],a=0;a<this.answers.length;a++){t.push(this.answers[a].user_id);for(var i=0;i<this.answers[a].comments.length;i++)t.push(this.answers[a].comments[i].user_id)}if(""!==this.myanswer){t.push(this.myanswer.user_id);for(var r=0;r<this.myanswer.comments.length;r++)t.push(this.myanswer.comments[r].user_id)}if(0!==t.length){var o={uuid:encodeURIComponent(JSON.stringify(t))};this.$axios.get(this.global.api.backurl+"user/getNames",{params:o,headers:{"access-token":this.util.generateToken(JSON.stringify(o),s),timestamp2:s}}).then((function(s){if(200===s.status&&0===s.data.code){for(var t=s.data.data,a={},i={},r=0;r<t.length;r++)a[t[r].uuid]=t[r].nick,i[t[r].uuid]=t[r].avatar;for(var o=0;o<e.answers.length;o++){e.answers[o].nickname=a[e.answers[o].user_id],e.answers[o].avatar=i[e.answers[o].user_id];for(var n=0;n<e.answers[o].comments.length;n++)e.answers[o].comments[n].nickname=a[e.answers[o].comments[n].user_id],e.answers[o].comments[n].avatar=i[e.answers[o].comments[n].user_id]}if(""!==e.myanswer)for(var c=0;c<e.myanswer.comments.length;c++)e.myanswer.comments[c].nickname=a[e.myanswer.comments[c].user_id],e.myanswer.comments[c].avatar=i[e.myanswer.comments[c].user_id]}})).catch((function(e){console.log(e)}))}},needLogin:function(){this.loginDialog.show=!0},courseShare:function(){this.shareDialog.tx="https://www.shenlianclass.com/#/CourseDetail?courseid="+this.course.uuid,this.shareDialog.show=!0},paywithProblem:function(){this.payWaitDialog.show=!1,this.feedbackDialog.event="支付问题-课程购买",this.feedbackDialog.extras={out_trade_no:this.out_trade_no,classname:this.course.classname,classid:this.course.uuid},this.feedbackDialog.show=!0},getCourseById:function(e){var s=this,t=(new Date).getTime()+this.global.requestExpireT,a={courseid:e,userid:this.user.uuid};this.$axios.get(this.global.api.backurl+"course/getCourseById",{params:a,headers:{"access-token":this.util.generateToken(JSON.stringify(a),t),timestamp2:t}}).then((function(e){if(200===e.status&&0===e.data.code){var t=e.data.data;if(s.course=t.course[0],s.isPayed=t.payedCourse.length>0,s.tab=s.isPayed?"chapters":s.tab,s.setVideos(t.videos),s.homeworkAsk={hasaccept:1,reward:0,user_id:s.course.author,uuid:s.course.uuid},s.isWorkFinished=t.isFinishedHW,s.allAppraises=t.appraise,s.findMyAppraises(),t.studyProgress.length>0){for(var a=0;a<t.studyProgress.length;a++)s.studyProgress[t.studyProgress[a].video_id]={progress:t.studyProgress[a].progress,total:t.studyProgress[a].total};s.setProgress()}}})).catch((function(e){console.log(e)}))},getAvatar:function(e){return this.global.api.aliyunosshostpubread+"/"+e+".jpg"},submitAppraise:function(){var e=this;if("undefined"===typeof this.user.uuid)return toast("请先登陆后评论"),void(this.loginDialog.show=!0);if(this.isPayed){var s={user_id:this.user.uuid,course_id:this.course.uuid,star:this.appraiseStar+"",content:this.appraiseText},t=(new Date).getTime()+this.global.requestExpireT;this.$axios.post(this.global.api.backurl+"course/createAppraise",s,{headers:{"access-token":this.util.generateToken(JSON.stringify(s),t),timestamp2:t}}).then((function(s){200===s.status&&0===s.data.code&&(toast("评论成功"),e.showAppraise=!1,e.allAppraises.unshift({user_id:e.user.uuid,nick:e.user.nick,create_at:new Date,star:e.appraiseStar,content:e.appraiseText}))})).catch((function(e){console.log(e)}))}else toast("学习完课程后才可以评论")},getAppraise:function(){var e=this,s=(new Date).getTime()+this.global.requestExpireT,t={course_id:this.course.uuid};this.$axios.get(this.global.api.backurl+"course/getAppraise",{params:t,headers:{"access-token":this.util.generateToken(JSON.stringify(t),s),timestamp2:s}}).then((function(s){200===s.status&&0===s.data.code&&(e.allAppraises=s.data.data,e.findMyAppraises())})).catch((function(e){console.log(e)}))},findMyAppraises:function(){if("undefined"!==typeof this.user.uuid)for(var e=null,s=0;s<this.allAppraises.length;s++)if(this.allAppraises[s].user_id===this.user.uuid){this.showAppraise=!1,e=this.allAppraises[s],this.allAppraises.splice(s,1),this.allAppraises.unshift(e);break}},isMyWorkFinish:function(){var e=this;if("undefined"!==typeof this.user.uuid){var s=(new Date).getTime()+this.global.requestExpireT,t={userid:this.user.uuid,courseid:this.course.uuid};this.$axios.get(this.global.api.backurl+"course/isHomeWorkFinish",{params:t,headers:{"access-token":this.util.generateToken(JSON.stringify(t),s),timestamp2:s}}).then((function(s){200===s.status&&0===s.data.code&&(e.isWorkFinished=s.data.data)})).catch((function(e){}))}},handleImageAdded:function(e,s,t,a){var i=this,r=(new Date).getTime()+e.name.substring(e.name.length-4);this.util.uploadFile2OSS(this,r,e,!0,null,(function(){s.insertEmbed(t,"image",i.global.api.aliyunosshostpubread+"/"+r),a()}))},submitHomeWork:function(){var e=this;if("undefined"===typeof this.user.uuid)return toast("请先登陆后再回答"),void(this.loginDialog.show=!0);if(this.isPayed)if(this.textLength(this.homework)<10)toast("作业内容不能少于10个字哦");else if(this.textLength(this.homework)>1e3)toast("作业内容需小于1000字");else{this.util.loadingShow(this);var s={user_id:this.user.uuid,ask_id:this.course.uuid,content:this.homework,from:"course"},t=(new Date).getTime()+this.global.requestExpireT;this.$axios.post(this.global.api.backurl+"ask/createAnswer",s,{headers:{"access-token":this.util.generateToken(JSON.stringify(s),t),timestamp2:t}}).then((function(s){e.util.loadingHide(e),200===s.status&&0===s.data.code&&(e.isWorkFinished=!0,toast("提交成功,已到账奖励："+e.global.backendConfig.answerReward+"积分"),e.myanswer={accept:0,agree:0,ask_id:e.course.uuid,comment_new:"",comment_num:0,comments:[],comments_show:!1,content:e.homework,create_at:(new Date).getTime(),disagree:0,nickname:e.user.nick,avatar:e.user.avatar,user_id:e.user.uuid,uuid:s.data.data})}))}else toast("你还未学习这门课程哦！")},textLength:function(e){e=e.replace(/<\/?[^>]+(>|$)/g,"");var s=e.length;return s},downloadRes:function(){this.isPayed?Object(_["a"])(this.util.makeDownloadUrl(this,this.course.res_name)):toast("购买课程后可下载")},setFileIcon:function(){if("undefined"!==typeof this.course.res_name){var e=this.course.res_name.substring(this.course.res_name.length-3);return this.util.getFileIcon(e)}},getStudyProgress:function(){var e=this;if("undefined"!==typeof this.user.uuid){for(var s=(new Date).getTime()+this.global.requestExpireT,t=[],a=0;a<this.videos.length;a++)t.push(this.videos[a].video_id);var i={user_id:this.user.uuid,course_id:this.course.uuid,video_id:encodeURIComponent(JSON.stringify(t))};this.$axios.get(this.global.api.backurl+"studyProgress/getProgress",{params:i,headers:{"access-token":this.util.generateToken(JSON.stringify(i),s),timestamp2:s}}).then((function(s){if(200===s.status&&0===s.data.code){var t=s.data.data;if(t.length>0){for(var a=0;a<t.length;a++)e.studyProgress[t[a].video_id]={progress:t[a].progress,total:t[a].total};e.setProgress()}}})).catch((function(e){}))}},setProgress:function(){for(var e=0;e<this.videos.length;e++){var s=this.studyProgress[this.videos[e].video_id];s.total-s.progress<=5&&(this.videos[e].finished=!0)}},checkisPayed:function(){var e=this;if(!this.isPayed&&"undefined"!==typeof this.user.uuid){var s=(new Date).getTime()+this.global.requestExpireT,t={user_id:this.user.uuid,course_id:this.course.uuid};this.$axios.get(this.global.api.backurl+"course/isPayed",{params:t,headers:{"access-token":this.util.generateToken(JSON.stringify(t),s),timestamp2:s}}).then((function(s){200===s.status&&0===s.data.code&&s.data.data.length>=1&&(e.isPayed=!0,e.tab="chapters")})).catch((function(e){}))}},queryPayResult:function(e){var s=this;this.util.loadingShow(this);var t=(new Date).getTime()+this.global.requestExpireT,a={out_trade_no:e,subject_type:"1"};this.$axios.get(this.global.api.backurl+"alipay/getPayResult",{params:a,headers:{"access-token":this.util.generateToken(JSON.stringify(a),t),timestamp2:t}}).then((function(e){s.util.loadingHide(s),200===e.status&&0===e.data.code?(toast("购买成功!"),s.course=e.data.data.course,s.isPayed=!0,s.tab="chapters",s.setVideos(e.data.data.videos),s.getStudyProgress(),s.homeworkAsk={hasaccept:1,reward:0,user_id:s.course.author,uuid:s.course.uuid},s.isMyWorkFinish(),s.getAppraise()):6006===e.data.code&&toast("请完成支付后点击该操作")})).catch((function(e){console.log(e)}))},setVideos:function(e){for(var s=0;s<e.length;s++)e[s].finished=!1;this.videos=e},buyCourse:function(){if("undefined"===typeof this.user.uuid)return this.out_trade_no="",this.payurl="",toast(this.$t("login2buy")),void(this.loginDialog.show=!0);""!==this.course.classprice&&""===this.course.coin?this.buyUseAliPay(this.course.classprice):""===this.course.classprice&&""!==this.course.coin&&this.buyUseCoin()},buyUseCoin:function(){var e=this;if(this.user.coin-parseFloat(this.course.coin)<0){var s=parseInt(parseInt(this.course.coin)/10);this.$q.dialog({title:'积分余额不足<span style="color:#959595;font-size:14px;"> 当前余额:'+this.user.coin+"</span>",message:'用支付宝支付只需<span class="text-orange"> '+s+"元 </span>即可购买该课程",html:!0,ok:"确定",cancel:"取消"}).onOk((function(){e.buyUseAliPay(s)})).onCancel((function(){}))}else{this.util.loadingShow(this);var t={user_id:this.user.uuid,course_id:this.course.uuid,coin:this.course.coin},a=(new Date).getTime()+this.global.requestExpireT;this.$axios.post(this.global.api.backurl+"course/addPayedCourse",t,{headers:{"access-token":this.util.generateToken(JSON.stringify(t),a),timestamp2:a}}).then((function(s){if(e.util.loadingHide(e),200===s.status&&0===s.data.code&&"ok"===s.data.data){toast("购买成功"),e.isPayed=!0,e.tab="chapters";var t=JSON.parse(JSON.stringify(e.user));t.coin-=parseInt(e.course.coin),e.user=t,l.a.setItem("user",JSON.stringify(e.user))}}))}},finishedPay:function(){this.payWaitDialog.show=!1,this.queryPayResult(this.out_trade_no)},buyUseAliPay:function(e){var s=this;if(this.payWaitDialog.show=!0,""===this.out_trade_no||""===this.payurl){this.util.loadingShow(this);var t={user_id:this.user.uuid,subject_title:this.course.classname,subject_id:this.course.uuid,subject_type:"1",total_amount:e,return_url:"https://www.shenlianclass.com/#/CourseDetail"},a=(new Date).getTime()+this.global.requestExpireT;this.$axios.post(this.global.api.backurl+"alipay/tradePagePay",t,{headers:{"access-token":this.util.generateToken(JSON.stringify(t),a),timestamp2:a}}).then((function(e){if(s.util.loadingHide(s),200===e.status&&0===e.data.code){var t=e.data.data;s.out_trade_no=t.out_trade_no,s.payurl=t.payurl,Object(_["a"])(t.payurl)}}))}else Object(_["a"])(this.payurl)},chapterPlay:function(e,s){this.isPayed||s.freesee?(this.videoDialog.currentPlay=e,this.videoDialog.videos=this.videos,this.videoDialog.studyProgress=this.studyProgress,this.videoDialog.course_id=this.course.uuid,this.videoDialog.course_payed=this.isPayed,this.videoDialog.show=!0):this.buyCourse()},getVideos:function(){var e=this,s=(new Date).getTime()+this.global.requestExpireT,t={course_id:this.course.uuid+""};this.$axios.get(this.global.api.backurl+"video/getVideos",{params:t,headers:{"access-token":this.util.generateToken(JSON.stringify(t),s),timestamp2:s}}).then((function(s){200===s.status&&0===s.data.code&&(e.setVideos(s.data.data),e.getStudyProgress())}))}}},$=N,O=(t("4b89"),t("9989")),V=t("429b"),z=t("7460"),F=t("eb85"),W=t("adad"),J=t("823b"),E=t("3b16"),M=t("27f9"),H=t("daf4"),R=Object(h["a"])($,a,i,!1,null,"e27a8f0a",null);s["default"]=R.exports;m()(R,"components",{QPage:O["a"],QBtn:b["a"],QTabs:V["a"],QTab:z["a"],QSeparator:F["a"],QTabPanels:W["a"],QTabPanel:J["a"],QTooltip:w["a"],QPagination:E["a"],QInput:M["a"],QRating:H["a"]})},ccb3:function(e,s,t){"use strict";var a=t("dded"),i=t.n(a);i.a},dded:function(e,s,t){},fbc2:function(e,s,t){}}]);