(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[14],{"851a":function(e,t,s){},"937f":function(e,t,s){"use strict";var i=s("851a"),a=s.n(i);a.a},bdfd:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-page",{staticClass:"mypage"},[s("GoBack"),s("div",{staticClass:"page-content",staticStyle:{"margin-top":"5px"}},[s("span",{staticClass:"res-name"},[e._v(e._s(e.resDetail.name))]),s("div",{staticStyle:{display:"flex"}},[s("img",{staticStyle:{"margin-left":"20px",width:"48px",height:"48px"},attrs:{src:e.setFileIcon()}}),s("div",{staticStyle:{"margin-left":"20px"}},[s("div",{domProps:{innerHTML:e._s(e.resDetail.discribe)}}),s("div",{staticStyle:{"margin-top":"10px"}},[s("span",{staticClass:"mytx-tip"},[e._v("\n            所需积分：\n            "),s("span",{staticStyle:{"font-size":"16px",color:"orange"}},[e._v(e._s(e.resDetail.coin))]),s("span",{directives:[{name:"show",rawName:"v-show",value:""!==e.resDetail.course_id,expression:"resDetail.course_id!==''"}]},[e._v("（已购买课程可免积分下载）")])]),s("span",{directives:[{name:"show",rawName:"v-show",value:""!==e.resDetail.course_id,expression:"resDetail.course_id!==''"}],staticClass:"mytx-tip",staticStyle:{"margin-left":"20px"}},[e._v("\n            所属课程：\n            "),s("span",{staticClass:"course-tx",on:{click:function(t){return e.gotoCourse(e.resDetail.course_id)}}},[e._v(e._s(e.resDetail.course_name))])]),s("span",{staticClass:"mytx-tip",staticStyle:{"margin-left":"20px"}},[e._v("上传时间："+e._s(e.util.getShortTime(e.resDetail.create_at)))]),s("span",{staticClass:"mytx-tip",staticStyle:{"margin-left":"20px"}},[e._v("资源大小："+e._s(e.resDetail.filesize)+" M")])])])]),s("q-btn",{staticStyle:{width:"150px",margin:"20px 0 0 20px"},attrs:{unelevated:"",color:"primary",label:"立即下载"},on:{click:e.downRes}})],1),s("MyFooter"),s("LoginDialog",{attrs:{dialogData:e.loginDialog}})],1)},a=[],r=s("a3d9"),n=s("198e"),o=s("b06b"),u=s("a002"),l=s.n(u),c=s("51ff"),d={components:{MyFooter:r["a"],GoBack:n["a"],LoginDialog:c["a"]},data:function(){return{resDetail:"",coursePayed:!1,loginDialog:{show:!1,title:"快捷登陆"},isResPayed:!1}},computed:{user:{get:function(){return this.$store.state.user.user},set:function(e){this.$store.commit("user/updateUser",e)}}},mounted:function(){"undefined"===typeof this.$route.query.uuid?("[object Object]"===this.$route.query.arg?this.resDetail=this.global.routeCache.ressouceDetail:(this.resDetail=this.$route.query.arg,this.global.routeCache.ressouceDetail=this.resDetail),this.checkisPayed(),this.checkResIsPayed()):this.getResById(this.$route.query.uuid)},methods:{getResById:function(e){var t=this,s=(new Date).getTime()+this.global.requestExpireT,i={uuid:e};this.$axios.get(this.global.api.backurl+"resourcedown/getResById",{params:i,headers:{"access-token":this.util.generateToken(JSON.stringify(i),s),timestamp2:s}}).then((function(e){200===e.status&&0===e.data.code&&(t.resDetail=e.data.data[0],t.checkisPayed(),t.checkResIsPayed())})).catch((function(e){console.log(e)}))},setFileIcon:function(){if(""===this.resDetail)return"";var e=this.resDetail.filename.substring(this.resDetail.filename.length-3);return this.util.getFileIcon(e)},checkisPayed:function(){var e=this;if(""!==this.resDetail.course_id&&"undefined"!==typeof this.user.uuid){var t=(new Date).getTime()+this.global.requestExpireT,s={user_id:this.user.uuid,course_id:this.resDetail.course_id};this.$axios.get(this.global.api.backurl+"course/isPayed",{params:s,headers:{"access-token":this.util.generateToken(JSON.stringify(s),t),timestamp2:t}}).then((function(t){200===t.status&&0===t.data.code&&t.data.data.length>=1&&(e.coursePayed=!0)}))}},checkResIsPayed:function(){var e=this;if("undefined"!==typeof this.user.uuid){var t=(new Date).getTime()+this.global.requestExpireT,s={user_id:this.user.uuid,resource_id:this.resDetail.uuid};this.$axios.get(this.global.api.backurl+"resourcedown/isPayed",{params:s,headers:{"access-token":this.util.generateToken(JSON.stringify(s),t),timestamp2:t}}).then((function(t){200===t.status&&0===t.data.code&&t.data.data.length>0&&(e.isResPayed=!0)}))}},gotoCourse:function(e){this.$router.push({path:"/CourseDetail",query:{courseid:e}})},downRes:function(){if("undefined"===typeof this.user.uuid)return toast("请先登陆再下载"),void(this.loginDialog.show=!0);if(this.coursePayed)toast("您已购买过该课程，已免积分下载");else if(this.isResPayed);else{if(this.user.coin-parseFloat(this.resDetail.coin)<0)return void toast("您的积分余额不足，请在个人中心充值后再进行下载");this.updateUserCoin()}Object(o["a"])(this.util.makeDownloadUrl(this,this.resDetail.filename)),this.addDownNum()},addDownNum:function(){var e=(new Date).getTime()+this.global.requestExpireT;this.$axios.put(this.global.api.backurl+"resourcedown/addDownNum?uuid="+this.resDetail.uuid,null,{headers:{"access-token":this.util.generateToken(null,e),timestamp2:e}})},updateUserCoin:function(){var e=this,t=this.user.coin-parseInt(this.resDetail.coin),s=(new Date).getTime()+this.global.requestExpireT,i={coin:t,coinChange:this.resDetail.coin,resource_id:this.resDetail.uuid};this.$axios.put(this.global.api.backurl+"user/dwonloadResource?uuid="+this.user.uuid,i,{headers:{"access-token":this.util.generateToken(JSON.stringify(i),s),timestamp2:s}}).then((function(s){if(200===s.status&&0===s.data.code){e.isResPayed=!0;var i=JSON.parse(JSON.stringify(e.user));i.coin=t,e.user=i,l.a.setItem("user",JSON.stringify(e.user))}}))}}},h=d,p=(s("937f"),s("2877")),g=s("eebe"),f=s.n(g),m=s("9989"),y=s("9c40"),D=Object(p["a"])(h,i,a,!1,null,"231f0589",null);t["default"]=D.exports;f()(D,"components",{QPage:m["a"],QBtn:y["a"]})}}]);